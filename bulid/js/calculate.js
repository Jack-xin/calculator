!function(){function Calculator(t,s,e,i){this.num="",this.express="",this.enterBar=t,this.outputBar=s,this.deg=e,this.color=i}var π=Math.PI,patPow=/\^/,patOther=new RegExp("\\π|\\.|\\)"),patSinceOperate=new RegExp("sin|cos|tan|√");Calculator.prototype={calculate:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":case"×":case"÷":case"π":case"%":this.num+=String(t);break;case"0":this.checkZero.call(this);break;case"=":this.equal.call(this);break;case"()":this.checkBracket.call(this);break;case"C":this.num="",this.express="";break;case"Del":this.delete.call(this);break;case".":this.checkDot.call(this);break;case"+/-":this.checkPosNeg.call(this);break;case"xⁿ":this.num+="^(";break;case"x²":this.num+="^(2)";break;case"sin":this.num+="sin(";break;case"cos":this.num+="cos(";break;case"tan":this.num+="tan(";break;case"√":this.num+="√("}this.enterBar.value=this.num,this.outputBar.value=this.express},equal:function(){var result=0,temp=this.num;temp=this.num.replace(/×/g,"*"),temp=temp.replace(/÷/g,"/"),temp=temp.replace(/%/g,"/100"),""!=this.num?(patPow.test(temp)&&(result=this.checkPow.call(this,temp),patSinceOperate.test(result)?(result=this.trigonometricFun.call(this,result,this.deg),temp=eval(result)):temp=eval(result)),patSinceOperate.test(temp)&&(result=this.trigonometricFun(temp,this.deg),temp=eval(result)),this.express=this.num,this.num=eval(temp)):this.num=""},checkZero:function(){""==this.num?this.num="0.":isNaN(this.num[this.num.length-1])?"."==this.num[this.num.length-1]?this.num+="0":this.num+="0.":this.num+="0"},checkBracket:function(){""==this.num?this.num+="(":isNaN(this.num[this.num.length-1])?")"==this.num[this.num.length-1]||"π"==this.num[this.num.length-1]||"%"==this.num[this.num.length-1]?this.outputBra.call(this):this.num+="(":this.outputBra.call(this)},checkDot:function(){var t,s;""==this.num?this.num+="0.":isNaN(this.num[this.num.length-1])?patOther.test(this.num[this.num.length-1])||"%"==this.num[this.num.length-1]?this.num=this.num:this.num+="0.":(t=this.getLastFlagPos.call(this,this.num,["+","-","*","/"]),(s=this.num.lastIndexOf("^"))>t?this.outputDot.call(this,".",s):this.outputDot.call(this,".",t))},checkPosNeg:function(){var leftBra,rightBra;""==this.num?this.num+="-":isNaN(this.num[this.num.length-1])?"("==this.num[this.num.length-1]?this.num+="-":")"==this.num[this.num.length-1]||"π"==this.num[this.num.length-1]?this.num=-eval(this.num):this.num+="(-":(leftBra=this.num.split("(").length-1,rightBra=this.num.split(")").length-1,this.num=leftBra>rightBra?"输入有误！":-eval(this.num))},delete:function(){""!=this.num?(this.num=this.num.substr(0,this.num.length-1),this.outputBar.value=this.num):this.num=this.num},checkPow:function(t){for(var s,e=t.split("^").length-1,i=t,n=0;n<e&&(s=i.lastIndexOf("^"))>-1;n++)i=this.pow.call(this,s,i);return i},pow:function(t,s){var e,i,n,a,r,u,h=0;return i=s.lastIndexOf("(",t),")"==s[t-1]?(r=s.substring(0,t).split("").reverse().join(""),u=this.getInnerEquation(r),e=r.length-1-u.lastBraPos,a=this.getPowResult.call(this,e,t,h,s)):(h=1,a=i>(n=this.getLastFlagPos(s.substring(0,t),["+","-","*","/"]))?this.getPowResult.call(this,i+1,t,h,s):this.getPowResult.call(this,n+1,t,h,s)),a},getPowResult:function(ag1,ag2,ag3,ag4){var powRightBra,inner={},powY,powX,firstPart,lastPart,powResult,equationResult,temp,hasOtherPow,tempReverse,baseNumReverse,baseNum;return inner=this.getInnerEquation(ag4.substring(ag2+1)),powY=patSinceOperate.test(inner.equation)?eval(this.trigonometricFun(inner.equation,this.deg)):eval(inner.equation),powRightBra=inner.lastBraPos,temp=ag4.substring(0,ag2),ag3?(hasOtherPow=temp.lastIndexOf("^"),hasOtherPow>=0?(powX=eval(temp.substring(ag1)),firstPart=ag4.substring(0,ag1)):(powX=eval(ag4.substring(ag1,ag2)),firstPart=ag4.substring(0,ag1))):(tempReverse=temp.split("").reverse().join(""),baseNumReverse=this.getInnerEquation(tempReverse),baseNum=baseNumReverse.equation.split("").reverse().join(""),powX=patSinceOperate.test(baseNum)?eval(this.trigonometricFun(baseNum,this.deg)):eval(this.checkPow(baseNum)),firstPart=ag4.substring(0,ag1)),powResult=String(Math.pow(powX,powY)),lastPart=ag4.substring(ag2+powRightBra+2),equationResult=String(firstPart+powResult+lastPart)},trigonometricFun:function(t,s){return s.style.backgroundColor==this.color?this.degTrigonometric(t):this.radTrigonometric(t,["sin","cos","tan","√"])},radTrigonometric:function(t,s){for(var e,i=t,n=s,a=0;a<n.length;a++)e=new RegExp(n[a],"g"),i=i.replace(e,"Math."+("√"==n[a]?n[a]="sqrt":n[a]));return i},degTrigonometric:function(str){var loopCount=0,sin=str.split("sin").length-1,cos=str.split("cos").length-1,tan=str.split("tan").length-1,lastTriPos,inner={},innerResult,result,firstPart,lastPart,newStr=str,trigonometric;if(0==(loopCount=sin+cos+tan))newStr=this.radTrigonometric(str,["√"]);else for(var i=0;i<loopCount;i++)lastTriPos=this.getLastFlagPos(newStr,["sin","cos","tan"]),inner=this.getInnerEquation(newStr.substring(lastTriPos+3)),innerResult=patPow.test(inner.equation)?this.checkPow(inner.equation):inner.equation.indexOf("√")>-1?this.radTrigonometric(inner.equation,["√"]):inner.equation,result=newStr.substr(lastTriPos,inner.lastBraPos+4),firstPart=newStr.substring(0,lastTriPos),firstPart=firstPart.indexOf("√")>-1?this.radTrigonometric(firstPart,["√"]):firstPart,lastPart=newStr.substring(lastTriPos+inner.lastBraPos+4),trigonometric=newStr.charAt(lastTriPos+1),"i"==trigonometric?result=Math.round(1e12*Math.sin(eval(innerResult)*Math.PI/180))/1e12:"o"==trigonometric?result=Math.round(1e12*Math.cos(eval(innerResult)*Math.PI/180))/1e12:"a"==trigonometric&&(result=Math.round(1e12*Math.tan(eval(innerResult)*Math.PI/180))/1e12),newStr=firstPart+result+lastPart;return newStr},getLastFlagPos:function(t,s){for(var e=s,i=[],n=0;n<e.length;n++)i.push(t.lastIndexOf(e[n]));return Math.max.apply(Array,i)},getInnerEquation:function(t){for(var s=0,e=0,i={},n=0;n<t.length;n++)if("("==t[n]&&(s+=1),")"==t[n]&&(e+=1),s==e){i.equation=t.substring(0,n+1),i.lastBraPos=n;break}return i},outputDot:function(t,s){this.num.indexOf(t,s)>0?this.num=this.num:this.num+="."},outputBra:function(){var t=this.num.split("(").length-1,s=this.num.split(")").length-1;this.num+=t>s?")":"*("},returnThisNum:function(){return this.num}},window.Calculator=Calculator}();